<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Create Your Skill Swap Account</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link rel="stylesheet" href="../css/userRegistration.css" />
    </head>
    <body>
        <div class="container">
            <h1>
                <i class="fas fa-exchange-alt"></i> Create Your Skill Swap
                Account
            </h1>
            <p class="form-header">
                Join our community of learners and teachers
            </p>

            <form id="registrationForm">
                <div class="form-group">
                    <label for="fullName"
                        ><i class="fas fa-user"></i> Full Name</label
                    >
                    <input
                        type="text"
                        id="fullName"
                        name="fullName"
                        placeholder="Enter your full name"
                        required
                    />
                    <div class="error-message" id="fullNameError">
                        Please enter your full and valid name(Only characters).
                    </div>
                </div>

                <div class="form-group">
                    <label for="username"
                        ><i class="fas fa-at"></i> Username</label
                    >
                    <input
                        type="text"
                        id="username"
                        name="username"
                        placeholder="Choose a username"
                        required
                    />
                    <div class="error-message" id="usernameError">
                        Username is required
                    </div>
                </div>

                <div class="form-group">
                    <label for="email"
                        ><i class="fas fa-envelope"></i> Email</label
                    >
                    <input
                        type="email"
                        id="email"
                        name="email"
                        placeholder="Enter your email address"
                        required
                    />
                    <div class="error-message" id="emailError">
                        Please enter a valid email address
                    </div>
                </div>
                <div class="form-group">
                    <label for="phone"
                        ><i class="fas fa-phone"></i> Contact Number</label
                    >
                    <input
                        type="tel"
                        id="phone"
                        name="phone"
                        placeholder="Enter your phone number"
                        required
                    />
                    <div class="error-message" id="contactError">
                        Please enter a valid contact number.
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="password"
                            ><i class="fas fa-lock"></i> Password</label
                        >
                        <input
                            type="password"
                            id="password"
                            name="password"
                            placeholder="Create a password"
                            required
                        />
                        <div class="password-strength">
                            <div
                                class="password-strength-bar"
                                id="passwordStrength"
                            ></div>
                        </div>
                        <div class="password-requirements">
                            <ul>
                                <li id="lengthReq" class="invalid">
                                    <i class="fas fa-circle"></i> At least 8
                                    characters
                                </li>
                                <li id="upperReq" class="invalid">
                                    <i class="fas fa-circle"></i> One uppercase
                                    letter
                                </li>
                                <li id="lowerReq" class="invalid">
                                    <i class="fas fa-circle"></i> One lowercase
                                    letter
                                </li>
                                <li id="numberReq" class="invalid">
                                    <i class="fas fa-circle"></i> One number
                                </li>
                            </ul>
                        </div>
                        <div class="error-message" id="passwordError">
                            Password must be at least 8 characters
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword"
                            ><i class="fas fa-lock"></i> Confirm Password</label
                        >
                        <input
                            type="password"
                            id="confirmPassword"
                            name="confirmPassword"
                            placeholder="Confirm your password"
                            required
                        />
                        <div class="error-message" id="confirmPasswordError">
                            Passwords do not match
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="profilePhoto"
                        ><i class="fas fa-camera"></i> Profile Photo</label
                    >
                    <div class="file-input-wrapper">
                        <div class="file-input-button">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>Upload Profile Photo</span>
                        </div>
                        <input
                            type="file"
                            id="profilePhoto"
                            name="profilePhoto"
                            accept="image/*"
                        />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="city"
                            ><i class="fas fa-city"></i> City</label
                        >
                        <input
                            type="text"
                            id="city"
                            name="city"
                            placeholder="Your city"
                        />
                    </div>

                    <div class="form-group">
                        <label for="country"
                            ><i class="fas fa-globe"></i> Country</label
                        >
                        <select id="country" name="country" required>
                            <option value="">Select your country</option>
                            <option value="India">India</option>
                            <option value="United States">United States</option>
                            <option value="United Kingdom">
                                United Kingdom
                            </option>
                            <option value="Canada">Canada</option>
                            <option value="Australia">Australia</option>
                            <option value="United Arab Emirates">
                                United Arab Emirates
                            </option>
                            <option value="Saudi Arabia">Saudi Arabia</option>
                            <option value="Singapore">Singapore</option>
                            <option value="Germany">Germany</option>
                            <option value="France">France</option>
                            <option value="Italy">Italy</option>
                            <option value="Spain">Spain</option>
                            <option value="Brazil">Brazil</option>
                            <option value="Mexico">Mexico</option>
                            <option value="Russia">Russia</option>
                            <option value="Japan">Japan</option>
                            <option value="China">China</option>
                            <option value="South Korea">South Korea</option>
                            <option value="South Africa">South Africa</option>
                            <option value="Nigeria">Nigeria</option>
                            <option value="Pakistan">Pakistan</option>
                            <option value="Bangladesh">Bangladesh</option>
                            <option value="Sri Lanka">Sri Lanka</option>
                            <option value="Nepal">Nepal</option>
                            <option value="Thailand">Thailand</option>
                            <option value="Vietnam">Vietnam</option>
                            <option value="Philippines">Philippines</option>
                            <option value="Malaysia">Malaysia</option>
                            <option value="Indonesia">Indonesia</option>
                            <option value="Hong Kong">Hong Kong</option>
                            <option value="Taiwan">Taiwan</option>
                            <option value="Turkey">Turkey</option>
                            <option value="Iran">Iran</option>
                            <option value="Iraq">Iraq</option>
                            <option value="Israel">Israel</option>
                            <option value="Egypt">Egypt</option>
                            <option value="Kenya">Kenya</option>
                            <option value="Ethiopia">Ethiopia</option>
                            <option value="Tanzania">Tanzania</option>
                            <option value="Ghana">Ghana</option>
                            <option value="Uganda">Uganda</option>
                            <option value="Argentina">Argentina</option>
                            <option value="Chile">Chile</option>
                            <option value="Colombia">Colombia</option>
                            <option value="Peru">Peru</option>
                            <option value="Venezuela">Venezuela</option>
                            <option value="Poland">Poland</option>
                            <option value="Netherlands">Netherlands</option>
                            <option value="Sweden">Sweden</option>
                            <option value="Norway">Norway</option>
                            <option value="Denmark">Denmark</option>
                            <option value="Finland">Finland</option>
                            <option value="Switzerland">Switzerland</option>
                            <option value="Belgium">Belgium</option>
                            <option value="Austria">Austria</option>
                            <option value="Czech Republic">
                                Czech Republic
                            </option>
                            <option value="Portugal">Portugal</option>
                            <option value="Ireland">Ireland</option>
                            <option value="Greece">Greece</option>
                            <option value="Hungary">Hungary</option>
                            <option value="Romania">Romania</option>
                            <option value="Bulgaria">Bulgaria</option>
                            <option value="Ukraine">Ukraine</option>
                            <option value="Kazakhstan">Kazakhstan</option>
                            <option value="New Zealand">New Zealand</option>
                            <option value="Qatar">Qatar</option>
                            <option value="Kuwait">Kuwait</option>
                            <option value="Oman">Oman</option>
                            <option value="Bahrain">Bahrain</option>
                            <option value="Jordan">Jordan</option>
                            <option value="Lebanon">Lebanon</option>
                            <option value="Myanmar">Myanmar</option>
                            <option value="Cambodia">Cambodia</option>
                            <option value="Laos">Laos</option>
                            <option value="Afghanistan">Afghanistan</option>
                            <option value="Sudan">Sudan</option>
                            <option value="Algeria">Algeria</option>
                            <option value="Morocco">Morocco</option>
                            <option value="Tunisia">Tunisia</option>
                            <option value="Cameroon">Cameroon</option>
                            <option value="Senegal">Senegal</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="bio"
                        ><i class="fas fa-user-edit"></i> Short Bio</label
                    >
                    <textarea
                        id="bio"
                        name="bio"
                        rows="3"
                        placeholder="Tell us about yourself and what skills you'd like to learn or share"
                    ></textarea>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="terms" name="terms" required />
                    <label for="terms"
                        >I agree to the
                        <a href="#" class="terms-link">Terms & Conditions</a>
                        and Privacy Policy. I understand that Skill Swap is a
                        community platform for sharing knowledge.</label
                    >
                </div>
                <div class="error-message" id="termsError">
                    You must agree to the terms and conditions
                </div>

                <button type="submit" class="submit-btn">
                    <i class="fas fa-user-plus"></i> Create My Skill Swap
                    Account
                </button>
            </form>
        </div>
        <div id="message-indicator"></div>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
            integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <script>
            const form = document.getElementById('registrationForm');

            form.addEventListener('submit', function (e) {
                e.preventDefault();

                // Reset error messages
                const errorMessages =
                    document.querySelectorAll('.error-message');
                errorMessages.forEach((msg) => (msg.style.display = 'none'));

                let isValid = true;

                // Validate full name
                const fullName = document.getElementById('fullName').value;
                const nameRegex = /^[a-zA-Z\s]+$/;
                if (!fullName.trim() || !nameRegex.test(fullName)) {
                    document.getElementById('fullNameError').style.display =
                        'block';
                    isValid = false;
                }

                const phoneNum = document.getElementById('phone').value;

                if (!phoneNum.trim()) {
                    document.getElementById('contactError').style.display =
                        'block';
                    isValid = false;
                }

                // Validate username
                const username = document.getElementById('username').value;
                if (!username.trim()) {
                    document.getElementById('usernameError').style.display =
                        'block';
                    isValid = false;
                }

                // Validate email
                const email = document.getElementById('email').value;
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    document.getElementById('emailError').style.display =
                        'block';
                    isValid = false;
                }

                // Validate password
                const password = document.getElementById('password').value;
                if (password.length < 8) {
                    document.getElementById('passwordError').style.display =
                        'block';
                    isValid = false;
                }

                // Validate confirm password
                const confirmPassword =
                    document.getElementById('confirmPassword').value;
                if (password !== confirmPassword) {
                    document.getElementById(
                        'confirmPasswordError'
                    ).style.display = 'block';
                    isValid = false;
                }

                // Validate terms
                const terms = document.getElementById('terms').checked;
                if (!terms) {
                    document.getElementById('termsError').style.display =
                        'block';
                    isValid = false;
                }

                if (isValid) {
                    const formData = new FormData(this);
                    // const formValues = Object.fromEntries(formData.entries());
                    // console.log('Form Submitted', formValues);

                    register(formData);
                }
            });

            // Password strength indicator
            document
                .getElementById('password')
                .addEventListener('input', function () {
                    checkPasswordStrength(this.value);
                });

            function checkPasswordStrength(password) {
                const strengthBar = document.getElementById('passwordStrength');
                const lengthReq = document.getElementById('lengthReq');
                const upperReq = document.getElementById('upperReq');
                const lowerReq = document.getElementById('lowerReq');
                const numberReq = document.getElementById('numberReq');

                // Reset classes
                strengthBar.className = 'password-strength-bar';
                lengthReq.className = 'invalid';
                upperReq.className = 'invalid';
                lowerReq.className = 'invalid';
                numberReq.className = 'invalid';

                let strength = 0;

                // Check length
                if (password.length >= 8) {
                    strength += 1;
                    lengthReq.className = 'valid';
                }

                // Check for uppercase letters
                if (/[A-Z]/.test(password)) {
                    strength += 1;
                    upperReq.className = 'valid';
                }

                // Check for lowercase letters
                if (/[a-z]/.test(password)) {
                    strength += 1;
                    lowerReq.className = 'valid';
                }

                // Check for numbers
                if (/[0-9]/.test(password)) {
                    strength += 1;
                    numberReq.className = 'valid';
                }

                // Update strength bar
                if (strength === 0) {
                    strengthBar.style.width = '0%';
                } else if (strength <= 2) {
                    strengthBar.className =
                        'password-strength-bar password-weak';
                } else if (strength === 3) {
                    strengthBar.className =
                        'password-strength-bar password-medium';
                } else {
                    strengthBar.className =
                        'password-strength-bar password-strong';
                }
            }

            function resetPasswordStrength() {
                const strengthBar = document.getElementById('passwordStrength');
                const lengthReq = document.getElementById('lengthReq');
                const upperReq = document.getElementById('upperReq');
                const lowerReq = document.getElementById('lowerReq');
                const numberReq = document.getElementById('numberReq');

                strengthBar.className = 'password-strength-bar';
                strengthBar.style.width = '0%';

                lengthReq.className = 'invalid';
                upperReq.className = 'invalid';
                lowerReq.className = 'invalid';
                numberReq.className = 'invalid';
            }

            // BACKEND IMPLEMENTATION AJAX

            function register(formData) {
                $.ajax({
                    url: '../api/saveRegistration.php',
                    method: 'POST',
                    data: formData,
                    multipart: true,
                    processData: false,
                    contentType: false,
                    dataType: 'json',
                    success: function (response) {
                        console.log(response);
                        if (response.status === 'success') {
                            type = 'success';
                            form.reset();
                            resetPasswordStrength();
                        } else {
                            type = 'error';
                        }
                        showMessage(type, response.message);
                    },
                    error: function (error) {
                        //message = xhr.statusText || error;
                        showMessage(
                            'error',
                            'Server error occurred. Please try again.'
                        );
                    },
                });
            }

            function showMessage(type, message) {
                const indicator = $('#message-indicator');
                indicator
                    .removeClass('success error')
                    .addClass(type)
                    .text(message)
                    .fadeIn();

                setTimeout(() => {
                    indicator.fadeOut();
                }, 3000);
            }
        </script>
    </body>
</html>
